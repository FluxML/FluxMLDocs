<!DOCTYPE html><HTML lang="en"><head><script charset="utf-8" src="../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/'</script><script charset="utf-8" src="../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Contributing to Metalhead · Metalhead.jl</title><script data-outdated-warner="" src="../assets/warner.js"></script><link href="nothing/metalhead/stable/contributing/" rel="canonical"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script data-main="../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" data-theme-name="documenter-dark" data-theme-primary-dark="" href="../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../assets/themeswap.js"></script><link href="../assets/flux.css" rel="stylesheet" type="text/css"/><link href="../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/></head><body><nav id="multi-page-nav"><div class="hidden-on-mobile" id="nav-items"><a class="nav-link nav-item" href="../../../flux/">Flux</a><div class="nav-dropdown"><button class="nav-item dropdown-label">Building Blocks</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Neural Network primitives</div><ul class="column-content"><a class="nav-link nav-item" href="../../../nnlib/">NNlib</a><a class="nav-link nav-item" href="../../../functors/">Functors</a></ul></div><div class="nav-mega-column"><div class="column-header">Automatic differentiation libraries</div><ul class="column-content"><a class="nav-link nav-item" href="../../../zygote/">Zygote</a></ul></div><div class="nav-mega-column"><div class="column-header">Neural Network primitives</div><ul class="column-content"><a class="nav-link nav-item" href="../../../nnlib/">NNlib</a></ul></div></div></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Training</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Data Wrangling</div><ul class="column-content"><a class="nav-link nav-item" href="../../../mlutils/">MLUtils</a><a class="nav-link nav-item" href="../../../onehotarrays/">OneHotArrays</a></ul></div><div class="nav-mega-column"><div class="column-header">Data Augmentation</div><ul class="column-content"><a class="nav-link nav-item" href="../../../dataaugmentation/">DataAugmentation</a></ul></div><div class="nav-mega-column"><div class="column-header">Datasets</div><ul class="column-content"><a class="nav-link nav-item" href="../../../mldatasets/">MLDatasets</a></ul></div><div class="nav-mega-column"><div class="column-header">Schedulers</div><ul class="column-content"><a class="nav-link nav-item" href="../../../paramschedulers/dev/">ParameterSchedulers</a></ul></div></div></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Models</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Computer Vision</div><ul class="column-content"><a class="nav-link active nav-item" href="../../">Metalhead</a></ul></div><div class="nav-mega-column"><div class="column-header">Natural Language Processing</div><ul class="column-content"><a class="nav-link nav-item" href="../../../transformers/">Transformers</a></ul></div></div></div><div class="search nav-item"><input id="search-input" placeholder="Search..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Metalhead.jl</a></span></div><form action="../search/" class="docs-search"><input class="docs-search-query" id="documenter-search-query" name="q" placeholder="Search docs" type="text"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/quickstart/">A guide to getting started with Metalhead</a></li><li><a class="tocitem" href="../tutorials/pretrained/">Working with pre-trained models from Metalhead</a></li></ul></li><li><span class="tocitem">Guides</span><ul><li><a class="tocitem" href="../howto/resnet/">Using the ResNet model family in Metalhead.jl</a></li></ul></li><li class="is-active"><a class="tocitem" href="">Contributing to Metalhead</a><ul class="internal"><li><a class="tocitem" href="#Fixing-bugs"><span>Fixing bugs</span></a></li><li><a class="tocitem" href="#Adding-models"><span>Adding models</span></a></li><li><a class="tocitem" href="#Adding-pre-trained-weights"><span>Adding pre-trained weights</span></a></li></ul></li><li><span class="tocitem">API reference</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Convolutional Neural Networks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../api/resnet/">ResNet-like models</a></li><li><a class="tocitem" href="../api/densenet/">DenseNet</a></li><li><a class="tocitem" href="../api/efficientnet/">EfficientNet family of models</a></li><li><a class="tocitem" href="../api/mobilenet/">MobileNet family of models</a></li><li><a class="tocitem" href="../api/inception/">Inception family of models</a></li><li><a class="tocitem" href="../api/hybrid/">Hybrid CNN architectures</a></li><li><a class="tocitem" href="../api/others/">Other models</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Mixers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../api/mixers/">MLPMixer-like models</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Vision Transformers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../api/vit/">Vision Transformer models</a></li></ul></li><li><a class="tocitem" href="../api/layers/">Layers</a></li><li><a class="tocitem" href="../api/utilities/">Model Utilities</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="">Contributing to Metalhead</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">Contributing to Metalhead</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/FluxML/Metalhead.jl/blob/master/docs/src/contributing.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a></div></header><article class="content" id="documenter-page"><h1 id="contributing"><a class="docs-heading-anchor" href="#contributing">Contribute to Metalhead.jl</a><a id="contributing-1"></a><a class="docs-heading-anchor-permalink" href="#contributing" title="Permalink"></a></h1><p>We welcome contributions from anyone to Metalhead.jl! Thank you for taking the time to make our ecosystem better.</p><p>You can contribute by fixing bugs, adding new models, or adding pre-trained weights. If you aren't ready to write some code, but you think you found a bug or have a feature request, please <a href="https://github.com/FluxML/Metalhead.jl/issues/new/choose">post an issue</a>.</p><p>Before continuing, make sure you read the <a href="https://github.com/FluxML/Flux.jl/blob/master/CONTRIBUTING.md">FluxML contributing guide</a> for general guidelines and tips.</p><h2 id="Fixing-bugs"><a class="docs-heading-anchor" href="#Fixing-bugs">Fixing bugs</a><a id="Fixing-bugs-1"></a><a class="docs-heading-anchor-permalink" href="#Fixing-bugs" title="Permalink"></a></h2><p>To fix a bug in Metalhead.jl, you can <a href="https://github.com/FluxML/Metalhead.jl/pulls">open a PR</a>. It would be helpful to file an issue first so that we can confirm the bug.</p><h2 id="Adding-models"><a class="docs-heading-anchor" href="#Adding-models">Adding models</a><a id="Adding-models-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-models" title="Permalink"></a></h2><p>To add a new model architecture to Metalhead.jl, you can <a href="https://github.com/FluxML/Metalhead.jl/pulls">open a PR</a>. Keep in mind a few guiding principles for how this package is designed:</p><ul><li>reuse layers from Flux as much as possible (e.g. use <code>Parallel</code> before defining a <code>Bottleneck</code> struct)</li><li>adhere as closely as possible to a reference such as a published paper (i.e. the structure of your model should follow intuitively from the paper)</li><li>use generic functional builders (e.g. <a href="../api/resnet/#Metalhead.resnet"><code>Metalhead.resnet</code></a> is the underlying function that builds "ResNet-like" models)</li><li>use multiple dispatch to add convenience constructors that wrap your functional builder</li></ul><p>When in doubt, just open a PR! We are more than happy to help review your code to help it align with the rest of the library. After adding a model, you might consider adding some pre-trained weights (see below).</p><h2 id="Adding-pre-trained-weights"><a class="docs-heading-anchor" href="#Adding-pre-trained-weights">Adding pre-trained weights</a><a id="Adding-pre-trained-weights-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-pre-trained-weights" title="Permalink"></a></h2><p>To add pre-trained weights for an existing model or new model, you can <a href="https://github.com/FluxML/Metalhead.jl/pulls">open a PR</a>. Below, we describe the steps you should follow to get there.</p><p>All Metalhead.jl model artifacts are hosted on HuggingFace. You can find the FluxML account <a href="https://huggingface.co/FluxML">here</a>. This <a href="https://huggingface.co/docs/hub/models">documentation from HuggingFace</a> will provide you with an introduction to their ModelHub. In short, the Model Hub is a collection of Git repositories, similar to Julia packages on GitHub. This means you can <a href="https://huggingface.co/docs/hub/repositories-pull-requests-discussions">make a pull request to our HuggingFace repositories</a> to upload updated weight artifacts just like you would make a PR on GitHub to upload code.</p><ol><li>Train your model or port the weights from another framework.</li><li>Save the model state using <a href="https://github.com/JuliaIO/BSON.jl">BSON.jl</a> with <code>BSON.@save "modelname.bson" model_state=Flux.state(model)</code>. It is important that your model is saved under the key <code>model_state</code>.</li><li>Compress the saved model as a tarball using <code>tar -cvzf modelname.tar.gz modelname.bson</code>.</li><li>Obtain the SHAs (see the <a href="https://pkgdocs.julialang.org/v1/artifacts/#Basic-Usage">Pkg docs</a>). Edit the <code>Artifacts.toml</code> file in the Metalhead.jl repository and add entry for your model. You can leave the URL empty for now.</li><li>Open a PR on Metalhead.jl. Be sure to ping a maintainer (e.g. <code>@darsnack</code> or <code>@theabhirath</code>) to let us know that you are adding a pre-trained weight. We will create a model repository on HuggingFace if it does not already exist.</li><li>Open a PR to the <a href="https://huggingface.co/FluxML">corresponding HuggingFace repo</a>. Do this by going to the "Community" tab in the HuggingFace repository. PRs and discussions are shown as the same thing in the HuggingFace web app. You can use your local Git program to make clone the repo and make PRs if you wish. Check out the <a href="https://huggingface.co/docs/hub/repositories-pull-requests-discussions">guide on PRs to HuggingFace</a> for more information.</li><li>Copy the download URL for the model file that you added to HuggingFace. Make sure to grab the URL for a specific commit and not for the <code>main</code> branch.</li><li>Update your Metalhead.jl PR by adding the URL to the Artifacts.toml.</li><li>If the tests pass for your weights, we will merge your PR! Your model should pass the <code>acctest</code> function in the Metalhead.jl test suite. If your model already exists in the repo, then these tests are already in place, and you can add your model configuration to the <code>PRETRAINED_MODELS</code> list in the <code>runtests.jl</code> file. Please refer to the ResNet tests as an example.</li></ol><p>If you want to fix existing weights, then you can follow the same set of steps.</p><p>See the <a href="https://github.com/FluxML/Metalhead.jl/tree/master/scripts">scripts/</a> folder in the repo for some helpful scripts that can be used to automate some of these steps.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../howto/resnet/">« Using the ResNet model family in Metalhead.jl</a><a class="docs-footer-nextpage" href="../api/resnet/">ResNet-like models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 14 July 2023 21:16">Friday 14 July 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>