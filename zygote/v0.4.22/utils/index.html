<!DOCTYPE html><HTML lang="en"><head><script charset="utf-8" src="../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/'</script><script charset="utf-8" src="../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Utilities · Zygote</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-36890222-9', 'auto');
ga('send', 'pageview', {'page': location.pathname + location.search + location.hash});
</script><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script data-main="../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" data-theme-name="documenter-dark" href="../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../assets/themeswap.js"></script><link href="nothing/zygote/stable/utils/" rel="canonical"/><link href="../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/></head><body><nav id="multi-page-nav"><div class="hidden-on-mobile" id="nav-items"><a class="nav-link nav-item" href="../../../flux/">Flux</a><div class="nav-dropdown"><button class="nav-item dropdown-label">Building Blocks</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Neural Network primitives</div><ul class="column-content"><a class="nav-link nav-item" href="../../../nnlib/">NNlib</a><a class="nav-link nav-item" href="../../../functors/">Functors</a></ul></div><div class="nav-mega-column"><div class="column-header">Automatic differentiation libraries</div><ul class="column-content"><a class="nav-link active nav-item" href="../../">Zygote</a></ul></div><div class="nav-mega-column"><div class="column-header">Neural Network primitives</div><ul class="column-content"><a class="nav-link nav-item" href="../../../nnlib/">NNlib</a></ul></div></div></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Training</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Data Wrangling</div><ul class="column-content"><a class="nav-link nav-item" href="../../../mlutils/">MLUtils</a><a class="nav-link nav-item" href="../../../onehotarrays/">OneHotArrays</a></ul></div><div class="nav-mega-column"><div class="column-header">Data Augmentation</div><ul class="column-content"><a class="nav-link nav-item" href="../../../dataaugmentation/">DataAugmentation</a></ul></div><div class="nav-mega-column"><div class="column-header">Datasets</div><ul class="column-content"><a class="nav-link nav-item" href="../../../mldatasets/">MLDatasets</a></ul></div><div class="nav-mega-column"><div class="column-header">Schedulers</div><ul class="column-content"><a class="nav-link nav-item" href="../../../paramschedulers/dev/">ParameterSchedulers</a></ul></div></div></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Models</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Computer Vision</div><ul class="column-content"><a class="nav-link nav-item" href="../../../metalhead/">Metalhead</a></ul></div><div class="nav-mega-column"><div class="column-header">Natural Language Processing</div><ul class="column-content"><a class="nav-link nav-item" href="../../../transformers/">Transformers</a></ul></div></div></div><div class="search nav-item"><input id="search-input" placeholder="Search..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Zygote</span></div><form action="../search/" class="docs-search"><input class="docs-search-query" id="documenter-search-query" name="q" placeholder="Search docs" type="text"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../adjoints/">Custom Adjoints</a></li><li class="is-active"><a class="tocitem" href="">Utilities</a></li><li><a class="tocitem" href="../complex/">Complex Differentiation</a></li><li><a class="tocitem" href="../profiling/">Profiling</a></li><li><a class="tocitem" href="../internals/">Internals</a></li><li><a class="tocitem" href="../glossary/">Glossary</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="">Utilities</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">Utilities</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/FluxML/Zygote.jl/blob/master/docs/src/utils.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a></div></header><article class="content" id="documenter-page"><h1 id="Utilities-1"><a class="docs-heading-anchor" href="#Utilities-1">Utilities</a><a class="docs-heading-anchor-permalink" href="#Utilities-1" title="Permalink"></a></h1><p>Zygote provides a set of helpful utilities. These are all "user-level" tools – in other words you could have written them easily yourself, but they live in Zygote for convenience.</p><article class="docstring"><header><a class="docstring-binding" href="#Zygote.@showgrad" id="Zygote.@showgrad"><code>Zygote.@showgrad</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia">@showgrad(x) -&gt; x</code></pre><p>Much like <code>@show</code>, but shows the gradient about to accumulate to <code>x</code>. Useful for debugging gradients.</p><pre><code class="language-none">julia&gt; gradient(2, 3) do a, b
         @showgrad(a)*b
       end
∂(a) = 3
(3, 2)</code></pre><p>Note that the gradient depends on how the output of <code>@showgrad</code> is <em>used</em>, and is not the <em>overall</em> gradient of the variable <code>a</code>. For example:</p><pre><code class="language-none">julia&gt; gradient(2) do a
     @showgrad(a)*a
   end
∂(a) = 2
(4,)

julia&gt; gradient(2, 3) do a, b
         @showgrad(a) # not used, so no gradient
         a*b
       end
∂(a) = nothing
(3, 2)</code></pre></div><a class="docs-sourcelink" href="https://github.com/FluxML/Zygote.jl/blob/ea9ed3bcbaf5d9d9d2217ec3c1a91ee953e12e60/src/lib/utils.jl#L67-L94" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Zygote.hook" id="Zygote.hook"><code>Zygote.hook</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">hook(x̄ -&gt; ..., x) -&gt; x</code></pre><p>Gradient hooks. Allows you to apply an arbitrary function to the gradient for <code>x</code>.</p><pre><code class="language-none">julia&gt; gradient(2, 3) do a, b
         hook(ā -&gt; @show(ā), a)*b
       end
ā = 3
(3, 2)

julia&gt; gradient(2, 3) do a, b
         hook(-, a)*b
       end
(-3, 2)</code></pre></div><a class="docs-sourcelink" href="https://github.com/FluxML/Zygote.jl/blob/ea9ed3bcbaf5d9d9d2217ec3c1a91ee953e12e60/src/lib/utils.jl#L46-L62" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Zygote.dropgrad" id="Zygote.dropgrad"><code>Zygote.dropgrad</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">dropgrad(x) -&gt; x</code></pre><p>Drop the gradient of <code>x</code>.</p><pre><code class="language-none">julia&gt; gradient(2, 3) do a, b
     dropgrad(a)*b
   end
(nothing, 2)</code></pre></div><a class="docs-sourcelink" href="https://github.com/FluxML/Zygote.jl/blob/ea9ed3bcbaf5d9d9d2217ec3c1a91ee953e12e60/src/lib/utils.jl#L1-L10" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Zygote.hessian" id="Zygote.hessian"><code>Zygote.hessian</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">hessian(f, x)</code></pre><p>Construct the Hessian of <code>f</code>, where <code>x</code> is a real or real array and <code>f(x)</code> is a real.</p><pre><code class="language-none">julia&gt; hessian(((a, b),) -&gt; a*b, [2, 3])
2×2 Array{Int64,2}:
 0  1
 1  0</code></pre></div><a class="docs-sourcelink" href="https://github.com/FluxML/Zygote.jl/blob/ea9ed3bcbaf5d9d9d2217ec3c1a91ee953e12e60/src/lib/utils.jl#L102-L112" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Zygote.Buffer" id="Zygote.Buffer"><code>Zygote.Buffer</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">Buffer(xs, ...)</code></pre><p><code>Buffer</code> is an array-like type which is mutable when taking gradients. You can construct a <code>Buffer</code> with the same syntax as <code>similar</code> (e.g. <code>Buffer(xs, 5)</code>) and then use normal indexing. Finally, use <code>copy</code> to get back a normal array.</p><p>For example:</p><pre><code class="language-julia">julia&gt; function vstack(xs)
           buf = Buffer(xs, length(xs), 5)
           for i = 1:5
             buf[:, i] = xs
           end
           return copy(buf)
         end
vstack (generic function with 1 method)

julia&gt; vstack([1, 2, 3])
3×5 Array{Int64,2}:
 1  1  1  1  1
 2  2  2  2  2
 3  3  3  3  3

julia&gt; gradient(x -&gt; sum(vstack(x)), [1, 2, 3])
([5.0, 5.0, 5.0],)</code></pre><p><code>Buffer</code> is not an <code>AbstractArray</code> and can't be used for linear algebra operations like matrix multiplication. This prevents it from being captured by pullbacks.</p><p><code>copy</code> is a semantic copy, but does not allocate memory. Instead the <code>Buffer</code> is made immutable after copying.</p></div><a class="docs-sourcelink" href="https://github.com/FluxML/Zygote.jl/blob/ea9ed3bcbaf5d9d9d2217ec3c1a91ee953e12e60/src/tools/buffer.jl#L1-L36" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Zygote.forwarddiff" id="Zygote.forwarddiff"><code>Zygote.forwarddiff</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">forwarddiff(f, x) -&gt; f(x)</code></pre><p>Runs <code>f(x)</code> as usual, but instructs Zygote to differentiate <code>f</code> using forward mode, rather than the usual reverse mode.</p><p>Forward mode takes time linear in <code>length(x)</code> but only has constant memory overhead, and is very efficient for scalars, so in some cases this can be a useful optimisation.</p><pre><code class="language-julia">julia&gt; function pow(x, n)
         r = one(x)
         for i = 1:n
           r *= x
         end
         return r
       end
pow (generic function with 1 method)

julia&gt; gradient(5) do x
         forwarddiff(x) do x
           pow(x, 2)
         end
       end
(10,)</code></pre><p>Note that the function <code>f</code> will <em>drop gradients</em> for any closed-over values.</p><pre><code class="language-julia">julia&gt; gradient(2, 3) do a, b
         forwarddiff(a) do a
           a*b
         end
       end
(3, nothing)</code></pre><p>This can be rewritten by explicitly passing through <code>b</code>, i.e.</p><pre><code class="language-julia">gradient(2, 3) do a, b
  forwarddiff([a, b]) do (a, b)
    a*b
  end
end</code></pre></div><a class="docs-sourcelink" href="https://github.com/FluxML/Zygote.jl/blob/ea9ed3bcbaf5d9d9d2217ec3c1a91ee953e12e60/src/lib/forward.jl#L49-L97" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Zygote.ignore" id="Zygote.ignore"><code>Zygote.ignore</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">ignore() do
  ...
end</code></pre><p>Tell Zygote to ignore a block of code. Everything inside the <code>do</code> block will run on the forward pass as normal, but Zygote won't try to differentiate it at all. This can be useful for e.g. code that does logging of the forward pass.</p><p>Obviously, you run the risk of incorrect gradients if you use this incorrectly.</p></div><a class="docs-sourcelink" href="https://github.com/FluxML/Zygote.jl/blob/ea9ed3bcbaf5d9d9d2217ec3c1a91ee953e12e60/src/lib/utils.jl#L14-L24" target="_blank">source</a></section></article><p><code>Params</code> and <code>Grads</code> can be copied to and from arrays using the <code>copy!</code> function.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../adjoints/">« Custom Adjoints</a><a class="docs-footer-nextpage" href="../complex/">Complex Differentiation »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 22 June 2020 08:27">Monday 22 June 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>